<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shakey's Pizza ‚Äì Delivery Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Playfair+Display:ital,wght@0,700;1,400&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --red:    #EE3B43;
            --yellow: #FEDE02;
            --black:  #231F20;
            --white:  #FFFFFF;
            --cream:  #FFF8E7;
            --red-dark: #C0272D;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Source Sans 3', sans-serif;
            background-color: var(--black);
            background-image:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 38px,
                    rgba(254,222,2,0.04) 38px,
                    rgba(254,222,2,0.04) 40px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 38px,
                    rgba(254,222,2,0.04) 38px,
                    rgba(254,222,2,0.04) 40px
                );
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px 60px;
        }

        /* ‚îÄ‚îÄ Outer card ‚îÄ‚îÄ */
        .card {
            width: 100%;
            max-width: 620px;
            background: var(--cream);

            /* Double black border as specified */
            border: 6px solid var(--black);
            outline: 6px solid var(--black);
            outline-offset: 6px;

            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 0 0 12px var(--yellow), 0 20px 60px rgba(0,0,0,0.7);
            animation: fadeUp 0.6s ease both;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        .header {
            background: var(--red);
            padding: 28px 30px 22px;
            text-align: center;
            border-bottom: 6px solid var(--black);
            position: relative;
        }

        .header::after {
            content: '';
            display: block;
            height: 6px;
            background: var(--yellow);
            position: absolute;
            bottom: -12px;
            left: 0; right: 0;
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 13px;
            letter-spacing: 4px;
            color: var(--yellow);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .brand-name {
            font-family: 'Oswald', sans-serif;
            font-size: 48px;
            font-weight: 700;
            color: var(--white);
            letter-spacing: -1px;
            line-height: 1;
            text-shadow: 3px 3px 0 var(--black);
        }

        .brand-sub {
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 400;
            color: var(--yellow);
            letter-spacing: 6px;
            text-transform: uppercase;
            margin-top: 4px;
        }

        .b2v-title {
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--red);
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--yellow);
        }

        .tagline {
            margin-top: 10px;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 13px;
            color: rgba(255,255,255,0.75);
        }

        /* ‚îÄ‚îÄ Form body ‚îÄ‚îÄ */
        .form-body {
            padding: 36px 32px 40px;
            margin-top: 6px; /* space for yellow stripe */
        }

        .section-label {
            font-family: 'Oswald', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--red);
            margin-bottom: 10px;
        }

        /* ‚îÄ‚îÄ Delivery time ‚îÄ‚îÄ */
        .delivery-block {
            background: var(--black);
            border-radius: 4px;
            padding: 18px 20px;
            margin-bottom: 28px;
            border: 3px solid var(--yellow);
        }

        .delivery-block .section-label {
            color: var(--yellow);
            margin-bottom: 14px;
        }

        .time-picker-wrap {
            position: relative;
            height: 150px;
            overflow: hidden;
            border-radius: 4px;
        }

        /* Gradient fades top and bottom */
        .time-picker-wrap::before,
        .time-picker-wrap::after {
            content: '';
            position: absolute;
            left: 0; right: 0;
            height: 46px;
            z-index: 2;
            pointer-events: none;
        }
        .time-picker-wrap::before {
            top: 0;
            background: linear-gradient(to bottom, var(--black) 0%, transparent 100%);
        }
        .time-picker-wrap::after {
            bottom: 0;
            background: linear-gradient(to top, var(--black) 0%, transparent 100%);
        }

        /* Highlight band for center slot */
        .time-picker-highlight {
            position: absolute;
            top: 50px;
            left: 0; right: 0;
            height: 50px;
            border: 2px solid var(--yellow);
            border-radius: 4px;
            background: rgba(254,222,2,0.08);
            z-index: 1;
            pointer-events: none;
        }

        .time-picker-scroll {
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .time-picker-scroll::-webkit-scrollbar { display: none; }

        .time-picker-scroll .tp-pad {
            height: 50px;
            flex-shrink: 0;
        }

        .time-slot {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: center;
            font-family: 'Oswald', sans-serif;
            font-size: 20px;
            font-weight: 500;
            letter-spacing: 2px;
            color: rgba(254,222,2,0.35);
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            user-select: none;
        }

        .time-slot.active {
            color: var(--yellow);
            font-size: 24px;
            font-weight: 700;
        }

        .time-slot.selected {
            color: var(--white);
            text-shadow: 0 0 12px rgba(254,222,2,0.5);
        }

        .time-no-slots {
            text-align: center;
            font-family: 'Oswald', sans-serif;
            font-size: 15px;
            color: var(--yellow);
            letter-spacing: 2px;
            padding: 20px;
        }

        /* ‚îÄ‚îÄ Field rows ‚îÄ‚îÄ */
        .field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-bottom: 18px;
        }

        .field-row.single {
            grid-template-columns: 1fr;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .field-group label {
            font-family: 'Oswald', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--black);
        }

        .field-group label .req {
            color: var(--red);
            margin-left: 2px;
        }

        .section-label .req {
            color: var(--red);
            margin-left: 2px;
        }

        .delivery-block .section-label .req {
            color: var(--white);
        }

        .field-group input[type="text"],
        .field-group input[type="tel"],
        .field-group input[type="email"],
        .field-group textarea {
            width: 100%;
            padding: 11px 14px;
            border: 2px solid #ccc;
            border-radius: 3px;
            font-size: 15px;
            font-family: 'Source Sans 3', sans-serif;
            background: var(--white);
            color: var(--black);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .field-group input:focus,
        .field-group textarea:focus {
            outline: none;
            border-color: var(--red);
            box-shadow: 0 0 0 3px rgba(238,59,67,0.15);
        }

        .field-group textarea {
            resize: vertical;
            min-height: 90px;
            line-height: 1.5;
        }

        /* ‚îÄ‚îÄ Divider ‚îÄ‚îÄ */
        .divider {
            height: 2px;
            background: linear-gradient(90deg, var(--red) 0%, var(--yellow) 50%, var(--red) 100%);
            margin: 24px 0;
            border-radius: 2px;
        }

        /* ‚îÄ‚îÄ Upload receipt ‚îÄ‚îÄ */
        .upload-area {
            border: 2px dashed #bbb;
            border-radius: 4px;
            padding: 28px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
            position: relative;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--red);
            background: #fff5f5;
        }

        .upload-area input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        .upload-main {
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--black);
            margin-bottom: 4px;
        }

        .upload-sub {
            font-size: 12px;
            color: #999;
        }

        .upload-filename {
            margin-top: 10px;
            font-size: 13px;
            color: var(--red);
            font-weight: 600;
            display: none;
        }

        /* ‚îÄ‚îÄ Submit button ‚îÄ‚îÄ */
        .submit-wrap {
            margin-top: 30px;
            text-align: center;
        }

        .submit-btn {
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 16px 56px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 3px;
            border-bottom: 4px solid var(--red-dark);
            transition: all 0.15s;
            box-shadow: 0 4px 16px rgba(238,59,67,0.35);
        }

        .submit-btn:hover {
            background: var(--red-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238,59,67,0.45);
        }

        .submit-btn:active {
            transform: translateY(1px);
            border-bottom-width: 2px;
        }

        .submit-note {
            margin-top: 12px;
            font-size: 12px;
            color: #999;
            font-style: italic;
        }

        /* ‚îÄ‚îÄ Footer stripe ‚îÄ‚îÄ */
        .footer-stripe {
            height: 10px;
            background: repeating-linear-gradient(
                90deg,
                var(--red) 0px, var(--red) 20px,
                var(--yellow) 20px, var(--yellow) 40px,
                var(--black) 40px, var(--black) 60px
            );
        }

        /* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
        @media (max-width: 520px) {
            body { padding: 20px 12px 40px; }
            .form-body { padding: 28px 20px 32px; }
            .field-row { grid-template-columns: 1fr; gap: 14px; }
            .brand-name { font-size: 36px; }
        }
    </style>
</head>
<body>

<div class="card">

    <!-- Header -->
    <div class="header">
        <div class="logo-text">Est. 1954 ¬∑ Sacramento, CA</div>
        <div class="brand-name">Shakey's</div>
        <div class="brand-sub">Pizza Parlor</div>
        <div class="tagline">"We Serve Fun at Shakey's‚Ä¶ Also Pizza"</div>
    </div>

    <!-- Form -->
    <form id="deliveryForm" class="form-body" onsubmit="handleSubmit(event)">

        <div class="b2v-title">LAXPD B2V Delivery Option</div>

        <!-- Steps -->
        <div style="display:flex; justify-content:space-between; gap:12px; margin-bottom:28px; text-align:center;">

            <div style="flex:1; background:var(--white); border:2px solid #e0e0e0; border-radius:6px; padding:16px 10px;">
                <div style="font-family:'Oswald',sans-serif; font-size:11px; letter-spacing:3px; color:var(--red); margin-bottom:8px;">STEP 1</div>
                <a href="https://www.shakeys.com/locations/los-angeles/inglewood-pizza-restaurant/" target="_blank" style="text-decoration:none; color:var(--black);">
                    <div style="font-size:28px; margin-bottom:6px;">üñ•Ô∏è</div>
                    <div style="font-family:'Oswald',sans-serif; font-size:13px; font-weight:600; letter-spacing:1px; text-transform:uppercase; color:var(--red); text-decoration:underline;">Order Online</div>
                </a>
            </div>

            <div style="flex:1; background:var(--white); border:2px solid #e0e0e0; border-radius:6px; padding:16px 10px;">
                <div style="font-family:'Oswald',sans-serif; font-size:11px; letter-spacing:3px; color:var(--red); margin-bottom:8px;">STEP 2</div>
                <div style="font-size:28px; margin-bottom:6px;">üßæ</div>
                <div style="font-family:'Oswald',sans-serif; font-size:13px; font-weight:600; letter-spacing:1px; text-transform:uppercase;">Copy Your Receipt</div>
            </div>

            <div style="flex:1; background:var(--white); border:2px solid #e0e0e0; border-radius:6px; padding:16px 10px;">
                <div style="font-family:'Oswald',sans-serif; font-size:11px; letter-spacing:3px; color:var(--red); margin-bottom:8px;">STEP 3</div>
                <div style="font-size:28px; margin-bottom:6px;">üìù</div>
                <div style="font-family:'Oswald',sans-serif; font-size:13px; font-weight:600; letter-spacing:1px; text-transform:uppercase;">Complete Form</div>
            </div>

        </div>

        <!-- Delivery Time -->
        <div class="delivery-block">
            <div class="section-label">üïê Indicate Your Pick-Up Time With Shakey's <span class="req">*</span></div>
            <input type="hidden" id="deliveryTime" name="deliveryTime" required>
            <div class="time-picker-wrap" id="timePickerWrap">
                <div class="time-picker-highlight"></div>
                <div class="time-picker-scroll" id="timeScroll"></div>
            </div>
        </div>

        <!-- Name -->
        <div class="field-row" style="grid-template-columns: 1fr 1fr;">
            <div class="field-group">
                <label>First Name <span class="req">*</span></label>
                <input type="text" name="firstName" placeholder="First" required>
            </div>
            <div class="field-group">
                <label>Last Name <span class="req">*</span></label>
                <input type="text" name="lastName" placeholder="Last" required>
            </div>
        </div>

        <!-- Address -->
        <div class="field-row single">
            <div class="field-group">
                <label>Delivery Address <span class="req">*</span></label>
                <input type="text" name="address" placeholder="123 Main St, Los Angeles, CA 90001" required>
            </div>
        </div>

        <!-- Phone -->
        <div class="field-row single">
            <div class="field-group">
                <label>Phone No. <span class="req">*</span></label>
                <input type="tel" name="phone" id="phone" placeholder="(555) 000-0000" required>
            </div>
        </div>

        <!-- Email -->
        <div class="field-row single">
            <div class="field-group">
                <label>Email <span class="req">*</span></label>
                <input type="email" name="email" placeholder="john@example.com" required>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Upload Receipt -->
        <div class="section-label">Upload Your Receipt <span class="req">*</span></div>
        <div class="upload-area" id="uploadArea">
            <input type="file" id="receiptFile" name="receipt" accept="image/*,.pdf" required>
            <span class="upload-icon">üìÑ</span>
            <div class="upload-main">Tap to upload your Shakey's receipt</div>
            <div class="upload-sub">JPG, PNG, or PDF ¬∑ Max 10MB</div>
            <div class="upload-filename" id="uploadFilename"></div>
        </div>

        <div class="divider"></div>

        <!-- Questions -->
        <div class="field-row single">
            <div class="field-group">
                <label>Questions / Special Instructions</label>
                <textarea name="questions" placeholder="Include any gate or access codes needed for delivery‚Ä¶"></textarea>
            </div>
        </div>

        <!-- Submit -->
        <div class="submit-wrap">
            <button type="submit" class="submit-btn" id="submitBtn">Place Order</button>
            <div class="submit-note">We'll confirm your delivery window by phone or email</div>
        </div>

    </form>

    <div class="footer-stripe"></div>
</div>

<script>
    // ‚îÄ‚îÄ Time Scroll Wheel Picker ‚îÄ‚îÄ
    // Half-hour slots from 11:00 AM ‚Äì 10:00 PM on March 4, 2026
    // Each slot expires 12 min after its time, except the last which expires with the prior slot
    function buildTimeSlots() {
        const slots = [];
        for (let h = 11; h <= 22; h++) {
            for (let m = 0; m < 60; m += 30) {
                if (h === 22 && m === 30) break; // stop at 10:00 PM
                slots.push({ h, m });
            }
        }
        return slots;
    }

    function formatTime(h, m) {
        const ampm = h < 12 ? 'AM' : 'PM';
        const hour = h % 12 === 0 ? 12 : h % 12;
        const min = m === 0 ? '00' : '30';
        return `${hour}:${min} ${ampm}`;
    }

    function getAvailableSlots() {
        const allSlots = buildTimeSlots();
        const now = new Date();

        // Build expiration for each slot
        return allSlots.filter((slot, i) => {
            const isLast = (i === allSlots.length - 1);
            let expiresAt;
            if (isLast) {
                // Last slot expires with prior slot's expiration
                const prev = allSlots[i - 1];
                expiresAt = new Date(2026, 2, 4, prev.h, prev.m + 12, 0);
            } else {
                expiresAt = new Date(2026, 2, 4, slot.h, slot.m + 12, 0);
            }
            return now < expiresAt;
        });
    }

    let selectedTimeValue = '';

    function populateWheel() {
        const scroll = document.getElementById('timeScroll');
        const hiddenInput = document.getElementById('deliveryTime');
        const wrap = document.getElementById('timePickerWrap');
        const available = getAvailableSlots();

        if (available.length === 0) {
            scroll.innerHTML = '<div class="time-no-slots">No times available</div>';
            wrap.style.height = 'auto';
            return;
        }

        scroll.innerHTML = '';
        // Top padding so first item can center
        const padTop = document.createElement('div');
        padTop.className = 'tp-pad';
        scroll.appendChild(padTop);

        available.forEach((slot, i) => {
            const el = document.createElement('div');
            el.className = 'time-slot';
            el.dataset.value = `${slot.h}:${slot.m === 0 ? '00' : '30'}`;
            el.dataset.index = i;
            el.textContent = formatTime(slot.h, slot.m);
            el.addEventListener('click', () => {
                // Scroll to center this item
                const targetTop = el.offsetTop - 50; // 50px = top pad to center
                scroll.scrollTo({ top: targetTop, behavior: 'smooth' });
            });
            scroll.appendChild(el);
        });

        // Bottom padding so last item can center
        const padBot = document.createElement('div');
        padBot.className = 'tp-pad';
        scroll.appendChild(padBot);

        // Handle scroll to detect center item
        function updateActive() {
            const scrollTop = scroll.scrollTop;
            const slots = scroll.querySelectorAll('.time-slot');
            let closest = null;
            let closestDist = Infinity;

            slots.forEach(s => {
                const slotCenter = s.offsetTop - scroll.offsetTop + 25; // 25 = half slot height
                const viewCenter = scrollTop + 75; // 75 = half of 150px container
                const dist = Math.abs(slotCenter - viewCenter);
                if (dist < closestDist) {
                    closestDist = dist;
                    closest = s;
                }
            });

            slots.forEach(s => s.classList.remove('active'));
            if (closest) {
                closest.classList.add('active');
                hiddenInput.value = closest.dataset.value;
                selectedTimeValue = closest.dataset.value;
            }
        }

        scroll.addEventListener('scroll', updateActive);
        // Initialize
        requestAnimationFrame(() => {
            scroll.scrollTop = 0;
            updateActive();
        });

        // Restore selection if still available
        if (selectedTimeValue) {
            const match = scroll.querySelector(`[data-value="${selectedTimeValue}"]`);
            if (match) {
                const targetTop = match.offsetTop - 50;
                scroll.scrollTo({ top: targetTop, behavior: 'auto' });
            }
        }
    }

    populateWheel();
    setInterval(populateWheel, 30000);

    // ‚îÄ‚îÄ Phone formatting ‚îÄ‚îÄ
    document.getElementById('phone').addEventListener('input', function () {
        let v = this.value.replace(/\D/g, '').slice(0, 10);
        if (v.length >= 7)      v = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6)}`;
        else if (v.length >= 4) v = `(${v.slice(0,3)}) ${v.slice(3)}`;
        else if (v.length >= 1) v = `(${v}`;
        this.value = v;
    });

    // ‚îÄ‚îÄ File upload display ‚îÄ‚îÄ
    const fileInput = document.getElementById('receiptFile');
    const uploadArea = document.getElementById('uploadArea');
    const filenameEl = document.getElementById('uploadFilename');

    fileInput.addEventListener('change', function () {
        if (this.files[0]) {
            filenameEl.textContent = '‚úì ' + this.files[0].name;
            filenameEl.style.display = 'block';
            uploadArea.style.borderColor = '#2ecc71';
            uploadArea.style.background = '#f0fff4';
        }
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', e => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files[0]) {
            fileInput.files = e.dataTransfer.files;
            filenameEl.textContent = '‚úì ' + e.dataTransfer.files[0].name;
            filenameEl.style.display = 'block';
            uploadArea.style.borderColor = '#2ecc71';
            uploadArea.style.background = '#f0fff4';
        }
    });

    // ‚îÄ‚îÄ Google Apps Script Web App URL ‚îÄ‚îÄ
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzaFOKho1c9ZigL22FNPMTJAhGl5YNYaj3lQbTlj4Mb0Cc9l-w09GWhB9sdr0Hu9V-p/exec';

    // ‚îÄ‚îÄ Form submission ‚îÄ‚îÄ
    async function handleSubmit(e) {
        e.preventDefault();
        const btn       = document.getElementById('submitBtn');
        const formEl    = document.getElementById('deliveryForm');
        const formData  = new FormData(formEl);
        const fileInput = document.getElementById('receiptFile');
        btn.disabled    = true;

        try {
            // ‚îÄ‚îÄ Collect order fields ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const firstName = formData.get('firstName')  || '';
            const lastName  = formData.get('lastName')   || '';
            const phone     = formData.get('phone')      || '';
            const email     = formData.get('email')      || '';

            // ‚îÄ‚îÄ Compress receipt to small JPEG (max 800px, 55% quality) ‚îÄ
            // Target: under 35KB base64 so it fits in one iframe form field
            let receiptBase64 = '';
            let receiptMime   = '';
            let receiptName   = '';

            if (fileInput.files && fileInput.files[0]) {
                btn.textContent = 'Processing receipt‚Ä¶';
                const file  = fileInput.files[0];
                const isPdf = file.type === 'application/pdf';

                if (isPdf) {
                    receiptBase64 = await fileToBase64(file);
                    receiptMime   = 'application/pdf';
                    receiptName   = firstName + '_' + lastName + '_' + phone + '_' + email + '.pdf';
                } else {
                    receiptBase64 = await compressToBase64(file, 800, 0.55);
                    receiptMime   = 'image/jpeg';
                    receiptName   = firstName + '_' + lastName + '_' + phone + '_' + email + '.jpg';
                }
            }

            // ‚îÄ‚îÄ Submit everything in one iframe POST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            btn.textContent = 'Submitting‚Ä¶';

            await iframePost(APPS_SCRIPT_URL, {
                action:        'order',
                deliveryTime:  formData.get('deliveryTime'),
                address:       formData.get('address'),
                firstName:     firstName,
                lastName:      lastName,
                phone:         phone,
                email:         email,
                questions:     formData.get('questions') || '',
                timestamp:     new Date().toLocaleString(),
                receiptBase64: receiptBase64,
                receiptMime:   receiptMime,
                receiptName:   receiptName
            });

            showSuccess(firstName);

        } catch (err) {
            console.error('Submit error:', err);
            btn.textContent   = 'Error ‚Äî Try Again';
            btn.style.background = '#c0392b';
            btn.disabled = false;
        }
    }

    // ‚îÄ‚îÄ Send fields as a hidden iframe form POST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function iframePost(url, fields) {
        return new Promise((resolve) => {
            const fname  = 'fr_' + Math.random().toString(36).slice(2);
            const iframe = document.createElement('iframe');
            iframe.name  = fname;
            iframe.style.display = 'none';
            iframe.onload = () => resolve();
            document.body.appendChild(iframe);

            const form   = document.createElement('form');
            form.method  = 'POST';
            form.action  = url;
            form.target  = fname;
            form.style.display = 'none';

            Object.entries(fields).forEach(([k, v]) => {
                const inp = document.createElement('input');
                inp.type  = 'hidden';
                inp.name  = k;
                inp.value = v != null ? String(v) : '';
                form.appendChild(inp);
            });

            document.body.appendChild(form);
            form.submit();
            setTimeout(resolve, 8000); // fallback
        });
    }

    // ‚îÄ‚îÄ Compress image to JPEG base64 at given maxWidth and quality ‚îÄ‚îÄ
    function compressToBase64(file, maxWidth, quality) {
        return new Promise((resolve, reject) => {
            const img    = new Image();
            const objUrl = URL.createObjectURL(file);
            img.onload = () => {
                URL.revokeObjectURL(objUrl);
                let w = img.naturalWidth;
                let h = img.naturalHeight;
                if (w > maxWidth) { h = Math.round(h * maxWidth / w); w = maxWidth; }
                const canvas = document.createElement('canvas');
                canvas.width  = w;
                canvas.height = h;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, w, h);
                ctx.drawImage(img, 0, 0, w, h);
                resolve(canvas.toDataURL('image/jpeg', quality).split(',')[1]);
            };
            img.onerror = () => { URL.revokeObjectURL(objUrl); reject(new Error('Image load failed')); };
            img.src = objUrl;
        });
    }

    // ‚îÄ‚îÄ Read file as base64 (PDFs) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader   = new FileReader();
            reader.onload  = () => resolve(reader.result.split(',')[1]);
            reader.onerror = () => reject(new Error('Read failed'));
            reader.readAsDataURL(file);
        });
    }
</script>

</body>
</html>
